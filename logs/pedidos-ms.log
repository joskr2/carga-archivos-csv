2025-08-04 07:27:18.715 [main] INFO  [] [] c.j.p.PedidosMsApplicationTests - Starting PedidosMsApplicationTests using Java 17.0.15 with PID 89543 (started by josuepatricio in /Users/josuepatricio/Downloads/pedidos-ms)
2025-08-04 07:27:18.716 [main] DEBUG [] [] c.j.p.PedidosMsApplicationTests - Running with Spring Boot v3.5.4, Spring v6.2.9
2025-08-04 07:27:18.716 [main] INFO  [] [] c.j.p.PedidosMsApplicationTests - The following 1 profile is active: "test"
2025-08-04 07:27:19.222 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-08-04 07:27:19.279 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 49 ms. Found 3 JPA repository interfaces.
2025-08-04 07:27:19.732 [main] INFO  [] [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-08-04 07:27:19.747 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-08-04 07:27:19.853 [main] INFO  [] [] com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb user=SA
2025-08-04 07:27:19.854 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-08-04 07:27:19.868 [main] WARN  [] [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-08-04 07:27:20.300 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:27:20.302 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:27:20.302 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:27:20.305 [main] DEBUG [] [] org.hibernate.SQL - create table cliente (id varchar(255) not null, nombre varchar(255), primary key (id))
2025-08-04 07:27:20.308 [main] DEBUG [] [] org.hibernate.SQL - create table pedido (fecha_entrega date, requiere_refrigeracion boolean not null, cliente_id varchar(255) not null, numero_pedido varchar(255) not null, zona_entrega varchar(255) not null, estado enum ('CONFIRMADO','ENTREGADO','PENDIENTE'), primary key (numero_pedido))
2025-08-04 07:27:20.309 [main] DEBUG [] [] org.hibernate.SQL - create table zona (soporte_refrigeracion boolean not null, id varchar(255) not null, primary key (id))
2025-08-04 07:27:20.309 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK30s8j2ktpay6of18lbyqn3632 foreign key (cliente_id) references cliente
2025-08-04 07:27:20.315 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK1aokin5yjk78h5cax5jju4fs9 foreign key (zona_entrega) references zona
2025-08-04 07:27:20.318 [main] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:27:20.656 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from cliente c1_0
2025-08-04 07:27:20.702 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:27:20.716 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:27:20.722 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:27:20.723 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:27:20.726 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from zona z1_0
2025-08-04 07:27:20.728 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:27:20.728 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:27:20.729 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:27:20.729 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:27:20.798 [main] WARN  [] [] o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-08-04 07:27:21.060 [main] INFO  [] [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb'
2025-08-04 07:27:21.072 [main] INFO  [] [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-08-04 07:27:21.120 [main] INFO  [] [] c.j.p.PedidosMsApplicationTests - Started PedidosMsApplicationTests in 2.628 seconds (process running for 5.655)
2025-08-04 07:27:21.426 [main] INFO  [] [] o.s.t.c.s.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [com.josue.pedidos_ms.infrastructure.controller.PedidoControllerIntegrationTest]: PedidoControllerIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2025-08-04 07:27:21.437 [main] INFO  [] [] o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration com.josue.pedidos_ms.PedidosMsApplication for test class com.josue.pedidos_ms.infrastructure.controller.PedidoControllerIntegrationTest
2025-08-04 07:27:21.439 [main] INFO  [] [] o.s.b.d.r.RestartApplicationListener - Restart disabled due to context in which it is running
2025-08-04 07:27:21.456 [main] INFO  [] [] c.j.p.i.c.PedidoControllerIntegrationTest - Starting PedidoControllerIntegrationTest using Java 17.0.15 with PID 89543 (started by josuepatricio in /Users/josuepatricio/Downloads/pedidos-ms)
2025-08-04 07:27:21.456 [main] DEBUG [] [] c.j.p.i.c.PedidoControllerIntegrationTest - Running with Spring Boot v3.5.4, Spring v6.2.9
2025-08-04 07:27:21.456 [main] INFO  [] [] c.j.p.i.c.PedidoControllerIntegrationTest - The following 1 profile is active: "test"
2025-08-04 07:27:21.587 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-08-04 07:27:21.595 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 5 ms. Found 3 JPA repository interfaces.
2025-08-04 07:27:21.652 [main] INFO  [] [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-08-04 07:27:21.652 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2025-08-04 07:27:21.662 [main] INFO  [] [] com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:testdb user=SA
2025-08-04 07:27:21.662 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2025-08-04 07:27:21.662 [main] WARN  [] [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-08-04 07:27:21.680 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:27:21.681 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:27:21.681 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:27:21.682 [main] DEBUG [] [] org.hibernate.SQL - create table cliente (id varchar(255) not null, nombre varchar(255), primary key (id))
2025-08-04 07:27:21.682 [main] DEBUG [] [] org.hibernate.SQL - create table pedido (fecha_entrega date, requiere_refrigeracion boolean not null, cliente_id varchar(255) not null, numero_pedido varchar(255) not null, zona_entrega varchar(255) not null, estado enum ('CONFIRMADO','ENTREGADO','PENDIENTE'), primary key (numero_pedido))
2025-08-04 07:27:21.683 [main] DEBUG [] [] org.hibernate.SQL - create table zona (soporte_refrigeracion boolean not null, id varchar(255) not null, primary key (id))
2025-08-04 07:27:21.683 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK30s8j2ktpay6of18lbyqn3632 foreign key (cliente_id) references cliente
2025-08-04 07:27:21.684 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK1aokin5yjk78h5cax5jju4fs9 foreign key (zona_entrega) references zona
2025-08-04 07:27:21.686 [main] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:27:21.713 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from cliente c1_0
2025-08-04 07:27:21.718 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:27:21.719 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:27:21.720 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:27:21.720 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:27:21.722 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from zona z1_0
2025-08-04 07:27:21.723 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:27:21.723 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:27:21.724 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:27:21.725 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:27:21.740 [main] WARN  [] [] o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-08-04 07:27:21.811 [main] INFO  [] [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb'
2025-08-04 07:27:21.823 [main] INFO  [] [] o.s.b.t.m.w.SpringBootMockServletContext - Initializing Spring TestDispatcherServlet ''
2025-08-04 07:27:21.823 [main] INFO  [] [] o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-08-04 07:27:21.825 [main] INFO  [] [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-08-04 07:27:21.829 [main] INFO  [] [] o.s.t.w.s.TestDispatcherServlet - Completed initialization in 6 ms
2025-08-04 07:27:21.841 [main] INFO  [] [] c.j.p.i.c.PedidoControllerIntegrationTest - Started PedidoControllerIntegrationTest in 0.402 seconds (process running for 6.377)
2025-08-04 07:27:21.846 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:27:21.849 [main] DEBUG [] [] org.hibernate.SQL - update cliente set nombre=? where id=?
2025-08-04 07:27:21.851 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:27:21.882 [main] INFO  [] [HTTP_REQUEST] c.j.p.i.controller.PedidoController - [INICIO_CARGA_CSV] POST /pedidos/cargar - Request ID: a915783a - Archivo: pedidos.csv - Tamaño: 122 bytes
2025-08-04 07:27:21.882 [main] INFO  [] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_CARGA_CSV] Iniciando procesamiento de archivo: pedidos.csv (tamaño: 122 bytes)
2025-08-04 07:27:21.888 [main] INFO  [] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_CARGA_CSV] Procesando 1 filas de datos (excluyendo cabecera)
2025-08-04 07:27:21.889 [main] DEBUG [P001] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_VALIDACION] Iniciando validación completa de pedido: P001
2025-08-04 07:27:21.889 [main] INFO  [P001] [CARGA_CSV] c.j.p.domain.service.PedidoValidator - [INICIO_VALIDACION] Validando número de pedido: P001
2025-08-04 07:27:21.916 [main] DEBUG [P001] [CARGA_CSV] org.hibernate.SQL - select count(*) from pedido p1_0 where p1_0.numero_pedido=?
2025-08-04 07:27:21.917 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.PedidoValidator - [PEDIDO_VALIDO] Número de pedido único y válido: P001
2025-08-04 07:27:21.918 [main] DEBUG [P001] [CARGA_CSV] c.j.p.d.service.ClienteValidator - [INICIO_VALIDACION] Validando cliente: CLI-123
2025-08-04 07:27:21.918 [main] DEBUG [P001] [CARGA_CSV] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:27:21.919 [main] DEBUG [P001] [CARGA_CSV] c.j.p.d.service.ClienteValidator - [PEDIDO_VALIDO] Cliente válido encontrado: CLI-123 - Test Cliente
2025-08-04 07:27:21.919 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.FechaValidator - [INICIO_VALIDACION] Validando fecha de entrega: 2099-08-10
2025-08-04 07:27:21.920 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.FechaValidator - [PEDIDO_VALIDO] Fecha de entrega válida: 2099-08-10 (días desde hoy: 27034)
2025-08-04 07:27:21.920 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.EstadoValidator - [INICIO_VALIDACION] Validando estado: PENDIENTE
2025-08-04 07:27:21.920 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.EstadoValidator - [PEDIDO_VALIDO] Estado válido: PENDIENTE
2025-08-04 07:27:21.920 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.ZonaValidator - [INICIO_VALIDACION] Validando zona: ZONA1 con refrigeración: true
2025-08-04 07:27:21.921 [main] DEBUG [P001] [CARGA_CSV] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:27:21.921 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.ZonaValidator - [PEDIDO_VALIDO] Zona válida: ZONA1 - Soporte refrigeración: true - Requerido: true
2025-08-04 07:27:21.921 [main] DEBUG [P001] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_VALIDO] Todas las validaciones pasaron exitosamente
2025-08-04 07:27:21.921 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Convirtiendo DTO a entidad de dominio: P001
2025-08-04 07:27:21.923 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Conversión exitosa - Pedido: P001, Cliente: CLI-123, Fecha: 2099-08-10, Estado: PENDIENTE, Zona: ZONA1, Refrigeración: true
2025-08-04 07:27:21.923 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Pedido válido agregado para guardado: P001
2025-08-04 07:27:21.923 [main] INFO  [P001] [PERSISTENCIA] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_GUARDADO] Guardando 1 pedidos válidos en base de datos
2025-08-04 07:27:21.924 [main] DEBUG [P001] [PERSISTENCIA] org.hibernate.SQL - select p1_0.numero_pedido,p1_0.cliente_id,c1_0.id,c1_0.nombre,p1_0.estado,p1_0.fecha_entrega,p1_0.requiere_refrigeracion,p1_0.zona_entrega,ze1_0.id,ze1_0.soporte_refrigeracion from pedido p1_0 join cliente c1_0 on c1_0.id=p1_0.cliente_id join zona ze1_0 on ze1_0.id=p1_0.zona_entrega where p1_0.numero_pedido=?
2025-08-04 07:27:21.927 [main] DEBUG [P001] [PERSISTENCIA] org.hibernate.SQL - insert into pedido (cliente_id,estado,fecha_entrega,requiere_refrigeracion,zona_entrega,numero_pedido) values (?,?,?,?,?,?)
2025-08-04 07:27:21.928 [main] INFO  [P001] [PERSISTENCIA] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_GUARDADO] Guardados exitosamente 1 pedidos
2025-08-04 07:27:21.929 [main] INFO  [] [] c.j.p.a.usecase.CargarPedidosUseCase - [RESUMEN_PROCESAMIENTO] Procesamiento completado - Total: 1, Guardados: 1, Errores: 0
2025-08-04 07:27:21.929 [main] INFO  [] [] c.j.p.i.controller.PedidoController - [FIN_CARGA_CSV] Request ID: a915783a - Procesamiento completado en 47ms - Total: 1, Guardados: 1, Tipos de errores: 0
2025-08-04 07:27:21.929 [main] ERROR [] [] c.j.p.i.controller.PedidoController - [[ERROR_SISTEMA, a915783a]] Request ID: {} - Error inesperado al procesar archivo
java.lang.UnsupportedOperationException: null
	at java.base/java.util.ImmutableCollections.uoe(ImmutableCollections.java:142)
	at java.base/java.util.ImmutableCollections$AbstractImmutableMap.put(ImmutableCollections.java:1072)
	at com.josue.pedidos_ms.infrastructure.controller.PedidoController.cargarArchivo(PedidoController.java:67)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.josue.pedidos_ms.infrastructure.controller.PedidoControllerIntegrationTest.cargarCsvConUnPedidoValidoDebeResponderCorrectamente(PedidoControllerIntegrationTest.java:50)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:775)
	at org.junit.platform.commons.support.ReflectionSupport.invokeMethod(ReflectionSupport.java:479)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:161)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:152)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:91)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:112)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:94)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:87)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:216)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:212)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:137)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:156)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:160)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:160)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:201)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:170)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:94)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:59)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:142)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.junit.platform.launcher.core.InterceptingLauncher.lambda$execute$1(InterceptingLauncher.java:39)
	at org.junit.platform.launcher.core.ClasspathAlignmentCheckingLauncherInterceptor.intercept(ClasspathAlignmentCheckingLauncherInterceptor.java:25)
	at org.junit.platform.launcher.core.InterceptingLauncher.execute(InterceptingLauncher.java:38)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:194)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:150)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-08-04 07:27:21.967 [SpringApplicationShutdownHook] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:27:21.968 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:27:21.971 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:27:21.971 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:27:21.972 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-08-04 07:27:21.973 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-08-04 07:27:21.975 [SpringApplicationShutdownHook] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:27:21.975 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:27:21.976 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:27:21.976 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:27:21.976 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown initiated...
2025-08-04 07:27:21.980 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown completed.
2025-08-04 07:28:24.960 [main] INFO  [] [] c.j.p.PedidosMsApplicationTests - Starting PedidosMsApplicationTests using Java 17.0.15 with PID 90137 (started by josuepatricio in /Users/josuepatricio/Downloads/pedidos-ms)
2025-08-04 07:28:24.961 [main] DEBUG [] [] c.j.p.PedidosMsApplicationTests - Running with Spring Boot v3.5.4, Spring v6.2.9
2025-08-04 07:28:24.961 [main] INFO  [] [] c.j.p.PedidosMsApplicationTests - The following 1 profile is active: "test"
2025-08-04 07:28:25.439 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-08-04 07:28:25.468 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 3 JPA repository interfaces.
2025-08-04 07:28:25.863 [main] INFO  [] [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-08-04 07:28:25.877 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-08-04 07:28:25.965 [main] INFO  [] [] com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb user=SA
2025-08-04 07:28:25.966 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-08-04 07:28:25.983 [main] WARN  [] [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-08-04 07:28:26.404 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:28:26.405 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:28:26.406 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:28:26.408 [main] DEBUG [] [] org.hibernate.SQL - create table cliente (id varchar(255) not null, nombre varchar(255), primary key (id))
2025-08-04 07:28:26.412 [main] DEBUG [] [] org.hibernate.SQL - create table pedido (fecha_entrega date, requiere_refrigeracion boolean not null, cliente_id varchar(255) not null, numero_pedido varchar(255) not null, zona_entrega varchar(255) not null, estado enum ('CONFIRMADO','ENTREGADO','PENDIENTE'), primary key (numero_pedido))
2025-08-04 07:28:26.412 [main] DEBUG [] [] org.hibernate.SQL - create table zona (soporte_refrigeracion boolean not null, id varchar(255) not null, primary key (id))
2025-08-04 07:28:26.413 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK30s8j2ktpay6of18lbyqn3632 foreign key (cliente_id) references cliente
2025-08-04 07:28:26.418 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK1aokin5yjk78h5cax5jju4fs9 foreign key (zona_entrega) references zona
2025-08-04 07:28:26.421 [main] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:28:26.762 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from cliente c1_0
2025-08-04 07:28:26.806 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:28:26.819 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:28:26.826 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:28:26.827 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:28:26.828 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from zona z1_0
2025-08-04 07:28:26.829 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:28:26.830 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:28:26.831 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:28:26.831 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:28:26.888 [main] WARN  [] [] o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-08-04 07:28:27.190 [main] INFO  [] [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb'
2025-08-04 07:28:27.204 [main] INFO  [] [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-08-04 07:28:27.257 [main] INFO  [] [] c.j.p.PedidosMsApplicationTests - Started PedidosMsApplicationTests in 2.499 seconds (process running for 2.996)
2025-08-04 07:28:27.641 [main] INFO  [] [] o.s.t.c.s.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [com.josue.pedidos_ms.infrastructure.controller.PedidoControllerIntegrationTest]: PedidoControllerIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2025-08-04 07:28:27.652 [main] INFO  [] [] o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration com.josue.pedidos_ms.PedidosMsApplication for test class com.josue.pedidos_ms.infrastructure.controller.PedidoControllerIntegrationTest
2025-08-04 07:28:27.654 [main] INFO  [] [] o.s.b.d.r.RestartApplicationListener - Restart disabled due to context in which it is running
2025-08-04 07:28:27.670 [main] INFO  [] [] c.j.p.i.c.PedidoControllerIntegrationTest - Starting PedidoControllerIntegrationTest using Java 17.0.15 with PID 90137 (started by josuepatricio in /Users/josuepatricio/Downloads/pedidos-ms)
2025-08-04 07:28:27.670 [main] DEBUG [] [] c.j.p.i.c.PedidoControllerIntegrationTest - Running with Spring Boot v3.5.4, Spring v6.2.9
2025-08-04 07:28:27.670 [main] INFO  [] [] c.j.p.i.c.PedidoControllerIntegrationTest - The following 1 profile is active: "test"
2025-08-04 07:28:27.803 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-08-04 07:28:27.808 [main] INFO  [] [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 4 ms. Found 3 JPA repository interfaces.
2025-08-04 07:28:27.860 [main] INFO  [] [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-08-04 07:28:27.861 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2025-08-04 07:28:27.862 [main] INFO  [] [] com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:testdb user=SA
2025-08-04 07:28:27.862 [main] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2025-08-04 07:28:27.862 [main] WARN  [] [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-08-04 07:28:27.876 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:28:27.877 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:28:27.878 [main] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:28:27.878 [main] DEBUG [] [] org.hibernate.SQL - create table cliente (id varchar(255) not null, nombre varchar(255), primary key (id))
2025-08-04 07:28:27.879 [main] DEBUG [] [] org.hibernate.SQL - create table pedido (fecha_entrega date, requiere_refrigeracion boolean not null, cliente_id varchar(255) not null, numero_pedido varchar(255) not null, zona_entrega varchar(255) not null, estado enum ('CONFIRMADO','ENTREGADO','PENDIENTE'), primary key (numero_pedido))
2025-08-04 07:28:27.879 [main] DEBUG [] [] org.hibernate.SQL - create table zona (soporte_refrigeracion boolean not null, id varchar(255) not null, primary key (id))
2025-08-04 07:28:27.880 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK30s8j2ktpay6of18lbyqn3632 foreign key (cliente_id) references cliente
2025-08-04 07:28:27.880 [main] DEBUG [] [] org.hibernate.SQL - alter table if exists pedido add constraint FK1aokin5yjk78h5cax5jju4fs9 foreign key (zona_entrega) references zona
2025-08-04 07:28:27.881 [main] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:28:27.907 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from cliente c1_0
2025-08-04 07:28:27.913 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:28:27.914 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:28:27.915 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:28:27.915 [main] DEBUG [] [] org.hibernate.SQL - insert into cliente (nombre,id) values (?,?)
2025-08-04 07:28:27.916 [main] DEBUG [] [] org.hibernate.SQL - select count(*) from zona z1_0
2025-08-04 07:28:27.917 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:28:27.917 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:28:27.918 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:28:27.918 [main] DEBUG [] [] org.hibernate.SQL - insert into zona (soporte_refrigeracion,id) values (?,?)
2025-08-04 07:28:27.942 [main] WARN  [] [] o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-08-04 07:28:28.002 [main] INFO  [] [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb'
2025-08-04 07:28:28.046 [main] INFO  [] [] o.s.b.t.m.w.SpringBootMockServletContext - Initializing Spring TestDispatcherServlet ''
2025-08-04 07:28:28.046 [main] INFO  [] [] o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-08-04 07:28:28.048 [main] INFO  [] [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-08-04 07:28:28.051 [main] INFO  [] [] o.s.t.w.s.TestDispatcherServlet - Completed initialization in 5 ms
2025-08-04 07:28:28.077 [main] INFO  [] [] c.j.p.i.c.PedidoControllerIntegrationTest - Started PedidoControllerIntegrationTest in 0.423 seconds (process running for 3.817)
2025-08-04 07:28:28.082 [main] DEBUG [] [] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:28:28.085 [main] DEBUG [] [] org.hibernate.SQL - update cliente set nombre=? where id=?
2025-08-04 07:28:28.088 [main] DEBUG [] [] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:28:28.133 [main] INFO  [] [HTTP_REQUEST] c.j.p.i.controller.PedidoController - [INICIO_CARGA_CSV] POST /pedidos/cargar - Request ID: d4f605e1 - Archivo: pedidos.csv - Tamaño: 122 bytes
2025-08-04 07:28:28.134 [main] INFO  [] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_CARGA_CSV] Iniciando procesamiento de archivo: pedidos.csv (tamaño: 122 bytes)
2025-08-04 07:28:28.159 [main] INFO  [] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_CARGA_CSV] Procesando 1 filas de datos (excluyendo cabecera)
2025-08-04 07:28:28.159 [main] DEBUG [P001] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_VALIDACION] Iniciando validación completa de pedido: P001
2025-08-04 07:28:28.159 [main] INFO  [P001] [CARGA_CSV] c.j.p.domain.service.PedidoValidator - [INICIO_VALIDACION] Validando número de pedido: P001
2025-08-04 07:28:28.205 [main] DEBUG [P001] [CARGA_CSV] org.hibernate.SQL - select count(*) from pedido p1_0 where p1_0.numero_pedido=?
2025-08-04 07:28:28.206 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.PedidoValidator - [PEDIDO_VALIDO] Número de pedido único y válido: P001
2025-08-04 07:28:28.206 [main] DEBUG [P001] [CARGA_CSV] c.j.p.d.service.ClienteValidator - [INICIO_VALIDACION] Validando cliente: CLI-123
2025-08-04 07:28:28.208 [main] DEBUG [P001] [CARGA_CSV] org.hibernate.SQL - select c1_0.id,c1_0.nombre from cliente c1_0 where c1_0.id=?
2025-08-04 07:28:28.209 [main] DEBUG [P001] [CARGA_CSV] c.j.p.d.service.ClienteValidator - [PEDIDO_VALIDO] Cliente válido encontrado: CLI-123 - Test Cliente
2025-08-04 07:28:28.209 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.FechaValidator - [INICIO_VALIDACION] Validando fecha de entrega: 2099-08-10
2025-08-04 07:28:28.210 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.FechaValidator - [PEDIDO_VALIDO] Fecha de entrega válida: 2099-08-10 (días desde hoy: 27034)
2025-08-04 07:28:28.211 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.EstadoValidator - [INICIO_VALIDACION] Validando estado: PENDIENTE
2025-08-04 07:28:28.211 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.EstadoValidator - [PEDIDO_VALIDO] Estado válido: PENDIENTE
2025-08-04 07:28:28.211 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.ZonaValidator - [INICIO_VALIDACION] Validando zona: ZONA1 con refrigeración: true
2025-08-04 07:28:28.212 [main] DEBUG [P001] [CARGA_CSV] org.hibernate.SQL - select z1_0.id,z1_0.soporte_refrigeracion from zona z1_0 where z1_0.id=?
2025-08-04 07:28:28.212 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.ZonaValidator - [PEDIDO_VALIDO] Zona válida: ZONA1 - Soporte refrigeración: true - Requerido: true
2025-08-04 07:28:28.213 [main] DEBUG [P001] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_VALIDO] Todas las validaciones pasaron exitosamente
2025-08-04 07:28:28.213 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Convirtiendo DTO a entidad de dominio: P001
2025-08-04 07:28:28.214 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Conversión exitosa - Pedido: P001, Cliente: CLI-123, Fecha: 2099-08-10, Estado: PENDIENTE, Zona: ZONA1, Refrigeración: true
2025-08-04 07:28:28.214 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Pedido válido agregado para guardado: P001
2025-08-04 07:28:28.214 [main] INFO  [P001] [PERSISTENCIA] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_GUARDADO] Guardando 1 pedidos válidos en base de datos
2025-08-04 07:28:28.215 [main] DEBUG [P001] [PERSISTENCIA] org.hibernate.SQL - select p1_0.numero_pedido,p1_0.cliente_id,c1_0.id,c1_0.nombre,p1_0.estado,p1_0.fecha_entrega,p1_0.requiere_refrigeracion,p1_0.zona_entrega,ze1_0.id,ze1_0.soporte_refrigeracion from pedido p1_0 join cliente c1_0 on c1_0.id=p1_0.cliente_id join zona ze1_0 on ze1_0.id=p1_0.zona_entrega where p1_0.numero_pedido=?
2025-08-04 07:28:28.218 [main] DEBUG [P001] [PERSISTENCIA] org.hibernate.SQL - insert into pedido (cliente_id,estado,fecha_entrega,requiere_refrigeracion,zona_entrega,numero_pedido) values (?,?,?,?,?,?)
2025-08-04 07:28:28.219 [main] INFO  [P001] [PERSISTENCIA] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_GUARDADO] Guardados exitosamente 1 pedidos
2025-08-04 07:28:28.219 [main] INFO  [] [] c.j.p.a.usecase.CargarPedidosUseCase - [RESUMEN_PROCESAMIENTO] Procesamiento completado - Total: 1, Guardados: 1, Errores: 0
2025-08-04 07:28:28.219 [main] INFO  [] [] c.j.p.i.controller.PedidoController - [FIN_CARGA_CSV] Request ID: d4f605e1 - Procesamiento completado en 85ms - Total: 1, Guardados: 1, Tipos de errores: 0
2025-08-04 07:28:28.545 [main] INFO  [] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_CARGA_CSV] Iniciando procesamiento de archivo: pedidos.csv (tamaño: 167 bytes)
2025-08-04 07:28:28.545 [main] INFO  [] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_CARGA_CSV] Procesando 2 filas de datos (excluyendo cabecera)
2025-08-04 07:28:28.545 [main] DEBUG [P001] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_VALIDACION] Iniciando validación completa de pedido: P001
2025-08-04 07:28:28.546 [main] INFO  [P001] [CARGA_CSV] c.j.p.domain.service.PedidoValidator - [INICIO_VALIDACION] Validando número de pedido: P001
2025-08-04 07:28:28.548 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.PedidoValidator - [PEDIDO_VALIDO] Número de pedido único y válido: P001
2025-08-04 07:28:28.548 [main] DEBUG [P001] [CARGA_CSV] c.j.p.d.service.ClienteValidator - [INICIO_VALIDACION] Validando cliente: CLI-123
2025-08-04 07:28:28.548 [main] DEBUG [P001] [CARGA_CSV] c.j.p.d.service.ClienteValidator - [PEDIDO_VALIDO] Cliente válido encontrado: CLI-123 - Cliente Test
2025-08-04 07:28:28.548 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.FechaValidator - [INICIO_VALIDACION] Validando fecha de entrega: 2099-08-10
2025-08-04 07:28:28.548 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.FechaValidator - [PEDIDO_VALIDO] Fecha de entrega válida: 2099-08-10 (días desde hoy: 27034)
2025-08-04 07:28:28.548 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.EstadoValidator - [INICIO_VALIDACION] Validando estado: PENDIENTE
2025-08-04 07:28:28.549 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.EstadoValidator - [PEDIDO_VALIDO] Estado válido: PENDIENTE
2025-08-04 07:28:28.549 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.ZonaValidator - [INICIO_VALIDACION] Validando zona: ZONA1 con refrigeración: true
2025-08-04 07:28:28.549 [main] DEBUG [P001] [CARGA_CSV] c.j.p.domain.service.ZonaValidator - [PEDIDO_VALIDO] Zona válida: ZONA1 - Soporte refrigeración: true - Requerido: true
2025-08-04 07:28:28.549 [main] DEBUG [P001] [CARGA_CSV] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_VALIDO] Todas las validaciones pasaron exitosamente
2025-08-04 07:28:28.549 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Convirtiendo DTO a entidad de dominio: P001
2025-08-04 07:28:28.549 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Conversión exitosa - Pedido: P001, Cliente: CLI-123, Fecha: 2099-08-10, Estado: PENDIENTE, Zona: ZONA1, Refrigeración: true
2025-08-04 07:28:28.550 [main] DEBUG [P001] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_PROCESADO] Pedido válido agregado para guardado: P001
2025-08-04 07:28:28.550 [main] DEBUG [P002] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [INICIO_VALIDACION] Iniciando validación completa de pedido: P002
2025-08-04 07:28:28.550 [main] INFO  [P002] [CONVERSION] c.j.p.domain.service.PedidoValidator - [INICIO_VALIDACION] Validando número de pedido: P002
2025-08-04 07:28:28.550 [main] DEBUG [P002] [CONVERSION] c.j.p.domain.service.PedidoValidator - [PEDIDO_VALIDO] Número de pedido único y válido: P002
2025-08-04 07:28:28.550 [main] DEBUG [P002] [CONVERSION] c.j.p.d.service.ClienteValidator - [INICIO_VALIDACION] Validando cliente: CLI-999
2025-08-04 07:28:28.551 [main] WARN  [P002] [CONVERSION] c.j.p.d.service.ClienteValidator - [PEDIDO_INVALIDO] Cliente no encontrado en base de datos: CLI-999
2025-08-04 07:28:28.551 [main] DEBUG [P002] [CONVERSION] c.j.p.domain.service.FechaValidator - [INICIO_VALIDACION] Validando fecha de entrega: 2020-01-01
2025-08-04 07:28:28.551 [main] WARN  [P002] [CONVERSION] c.j.p.domain.service.FechaValidator - [PEDIDO_INVALIDO] Fecha de entrega en el pasado: 2020-01-01 (hoy: 2025-08-04)
2025-08-04 07:28:28.551 [main] DEBUG [P002] [CONVERSION] c.j.p.domain.service.EstadoValidator - [INICIO_VALIDACION] Validando estado: INVALIDO
2025-08-04 07:28:28.551 [main] WARN  [P002] [CONVERSION] c.j.p.domain.service.EstadoValidator - [PEDIDO_INVALIDO] Estado inválido: INVALIDO. Estados válidos: PENDIENTE, CONFIRMADO, ENTREGADO
2025-08-04 07:28:28.551 [main] DEBUG [P002] [CONVERSION] c.j.p.domain.service.ZonaValidator - [INICIO_VALIDACION] Validando zona: ZONA2 con refrigeración: false
2025-08-04 07:28:28.552 [main] WARN  [P002] [CONVERSION] c.j.p.domain.service.ZonaValidator - [PEDIDO_INVALIDO] Zona no encontrada en base de datos: ZONA2
2025-08-04 07:28:28.552 [main] INFO  [P002] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [ESTADISTICAS_VALIDACION] Validación completada con 4 errores: [Clientes no encontrados, Fecha de entrega inválida, Estado inválido, Zonas inválidas]
2025-08-04 07:28:28.552 [main] WARN  [P002] [CONVERSION] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_INVALIDO] Pedido con 4 errores de validación
2025-08-04 07:28:28.552 [main] INFO  [P002] [PERSISTENCIA] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_GUARDADO] Guardando 1 pedidos válidos en base de datos
2025-08-04 07:28:28.552 [main] INFO  [P002] [PERSISTENCIA] c.j.p.a.usecase.CargarPedidosUseCase - [PEDIDO_GUARDADO] Guardados exitosamente 1 pedidos
2025-08-04 07:28:28.553 [main] INFO  [] [] c.j.p.a.usecase.CargarPedidosUseCase - [RESUMEN_PROCESAMIENTO] Procesamiento completado - Total: 2, Guardados: 1, Errores: 4
2025-08-04 07:28:28.586 [SpringApplicationShutdownHook] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:28:28.587 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:28:28.588 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:28:28.588 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:28:28.591 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-08-04 07:28:28.594 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-08-04 07:28:28.598 [SpringApplicationShutdownHook] INFO  [] [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-08-04 07:28:28.599 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists cliente cascade 
2025-08-04 07:28:28.599 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists pedido cascade 
2025-08-04 07:28:28.599 [SpringApplicationShutdownHook] DEBUG [] [] org.hibernate.SQL - drop table if exists zona cascade 
2025-08-04 07:28:28.600 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown initiated...
2025-08-04 07:28:28.600 [SpringApplicationShutdownHook] INFO  [] [] com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown completed.
